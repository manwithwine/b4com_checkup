# B4COM Network Checkup System

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ B4COM 4100 –≤ —Ä–µ—à–µ–Ω–∏–∏ EVPN/VXLAN.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ B4COM CS4100 –≤ —Ä–µ—à–µ–Ω–∏–∏ EVPN/VXLAN.\
–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞–±–æ—Ä –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.

![img.png](image/img.png)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```
### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–£–∫–∞–∂–∏—Ç–µ —É—á–µ—Ç–Ω—ã–π –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –≤ .env —Ñ–∞–π–ª–µ
```aiignore
# –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
DEVICE_USERNAME=–≤–∞—à_username
DEVICE_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
```
### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

–£–∫–∞–∂–∏—Ç–µ ip –∞–¥—Ä–µ—Å–∞ –¥–ª—è –ø–æ–¥–∫–ª—é–µ–Ω–∏—è –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
```aiignore
1.1.1.1
2.2.2.2
```
### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏

–ó–∞–ø—É—Å—Ç–∏—Ç–µ main.py
```
python3 main.py
```

### 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω HTML –æ—Ç—á–µ—Ç.
–ü—Ä–∏–º–µ—Ä –æ—Ç—á–µ—Ç–∞: [report_20251013_2328.html](image%2Freport_20251013_2328.html)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```aiignore
b4com_checkup/
‚îú‚îÄ‚îÄ üìÇ core/ # –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ ‚îú‚îÄ‚îÄ device_parser.py # –ü–∞—Ä—Å–µ—Ä –≤—ã–≤–æ–¥–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îÇ ‚îú‚îÄ‚îÄ device_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
‚îÇ ‚îî‚îÄ‚îÄ report_generator.py # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä HTML –æ—Ç—á–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ üìÇ metrics/ # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
‚îÇ ‚îú‚îÄ‚îÄ base_metric.py # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
‚îÇ ‚îú‚îÄ‚îÄ cpu_metric.py # –ú–µ—Ç—Ä–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CPU
‚îÇ ‚îú‚îÄ‚îÄ memory_metric.py # –ú–µ—Ç—Ä–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
‚îÇ ‚îú‚îÄ‚îÄ access_if_metric.py # –ú–µ—Ç—Ä–∏–∫–∞ access-if –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
‚îÇ ‚îî‚îÄ‚îÄ ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏)
‚îú‚îÄ‚îÄ üìÇ config/ # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ ‚îú‚îÄ‚îÄ commands.py # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
‚îÇ ‚îú‚îÄ‚îÄ hw_shell_commands.py # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è hw-shell —Ä–µ–∂–∏–º–∞
‚îÇ ‚îú‚îÄ‚îÄ thresholds.py # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –º–µ—Ç—Ä–∏–∫
‚îÇ ‚îú‚îÄ‚îÄ tooltips.py # –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤ –æ—Ç—á–µ—Ç–∞—Ö
‚îÇ ‚îî‚îÄ‚îÄ metrics_config.py # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
‚îú‚îÄ‚îÄ üìÇ templates/ # HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ ‚îî‚îÄ‚îÄ report_template.py # –®–∞–±–ª–æ–Ω HTML –æ—Ç—á–µ—Ç–∞
‚îú‚îÄ‚îÄ üìÇ utils/ # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ ‚îú‚îÄ‚îÄ file_utils.py # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ ‚îî‚îÄ‚îÄ network_utils.py # –°–µ—Ç–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ üìÑ main.py # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ üìÑ parser.py # –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ üìÑ .env # –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îú‚îÄ‚îÄ üìÑ ip.txt # –°–ø–∏—Å–æ–∫ IP –∞–¥—Ä–µ—Å–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îî‚îÄ‚îÄ üìÑ requirements.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
```

## –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

–°–∫—Ä–∏–ø—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ 15 –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π:

| –ú–µ—Ç—Ä–∏–∫–∞           | –û–ø–∏—Å–∞–Ω–∏–µ                             |
|-------------------|--------------------------------------|
| CPU               | –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞                  |
| Memory            | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏                 |
| Access Interfaces | VXLAN –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã                     |
| MAC VRF           | –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã           |
| IRB Interfaces    | Integrated Routing and Bridging      |
| L2VNI             | Layer 2 VNI                          |
| L3 SVI            | Switched Virtual Interfaces          |
| IP VRF            | IP Virtual Routing                   |
| EVPN Routes Count | MAC-only, MAC-IPv4/v6                |
| ASIC MAC          | MAC-–∞–¥—Ä–µ—Å–∞ –≤ ASIC                    |
| ES LAG            | EVPN Multihoming —Å–µ—Å—Å–∏–∏              |
| ARP Entries       | ARP –∑–∞–ø–∏—Å–∏                           |
| IPv4 Routes       | –ú–∞—Ä—à—Ä—É—Ç—ã IPv4                        |
| ECMP Groups       | ECMP –≥—Ä—É–ø–ø—ã                          |
| L3 Nexthops       | Next-hop –∑–∞–ø–∏—Å–∏                      |

```aiignore
‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–æ–ø–æ–ª–æ–≥–∏–∏ –∏ –¥–∏–∑–∞–π–Ω–∞ —Å–µ—Ç–∏.
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Ç–æ—á–Ω—è—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ —É –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π B4com.
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫:
1. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ commands.py/hw_shell_commands.py
2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –º–µ—Ç—Ä–∏–∫–∏ –≤ metrics/new_metric.py
```aiignore
# metrics/new_metric.py
from .base_metric import BaseMetric
from typing import Any, Dict
import re
from config.thresholds import get_threshold

class NewMetric(BaseMetric):
    def __init__(self):
        super().__init__(
            name="new_metric",
            description="New Metric Description",
            display_name="NEW METRIC" # —Ç–æ, –∫–∞–∫ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –º–µ—Ç—Ä–∏–∫–∞ –≤ –æ—Ç—á—ë—Ç–µ
        )
        self.threshold = get_threshold("new_metric")
    
    def extract_value(self, content: str) -> Any:
        # –õ–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥
        match = re.search(r'Your Pattern:\s+(\d+)', content)
        return int(match.group(1)) if match else None
    
    def check_threshold(self, value: int) -> Dict[str, Any]:
        if value <= self.threshold:
            status = "OK"
        else:
            status = "ALERT"
        
        return {
            "status": status,
            "details": f"{value}<br>Result={status}",
            "raw_data": value
        }
```
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –º–µ—Ç—Ä–∏–∫—É –≤ config/metrics_config.py
```aiignore
from metrics.new_metric import NewMetric

METRICS_REGISTRY = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    "new_metric": NewMetric(),
}
```
4. –î–æ–±–∞–≤—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ –≤ config/thresholds.py
```aiignore
THRESHOLDS = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Ä–æ–≥–∏
    "new_metric": 100,
}

def get_threshold_row():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –ø–æ—Ä–æ–≥–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü"""
    return [
        ...
        f"‚â§{THRESHOLDS['new_metric']}%"
    ]
```
5. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É –≤ config/tooltips.py
```aiignore
METRIC_TOOLTIPS = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    "new_metric": "–û–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–µ—Ç—Ä–∏–∫–∏\n‚Ä¢ –ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç\n‚Ä¢ –ö–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å\n\n–ü–æ—Ä–æ–≥: ‚â§100",
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
1. –û—Ç–∫—Ä–æ–π—Ç–µ config/thresholds.py
2. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è


## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

–û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ error_log.txt:
```aiignore
2023-12-01 14:30:15: 100.64.0.19 - Connection timeout
2023-12-01 14:31:22: 100.64.0.20 - Authentication failed
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
* –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–∞–ø–∫—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤ cfg/
* –í—Å–µ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ thresholds.py
* –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –æ—Ç—á–µ—Ç–∞—Ö
* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –≤ HTML –æ—Ç—á–µ—Ç–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –º–µ—Ç—Ä–∏–∫

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø–∏—Å–∞—Ç—å –Ω–∞ –ø–æ—á—Ç—É mkmklsfml@gmail.com –∏–ª–∏ –≤ tg: @manwithwine\
v1.0